# 算術邏輯單元元件說明文件

## 加法器元件

### HalfAdder (半加器)
- **功能**: 計算兩個位元的和與進位
- **輸入**: a, b
- **輸出**: sum, carry
- **真值表**:
  ```
  a | b | carry | sum
  ---+---+-------+-----
  0 | 0 |   0   |  0
  0 | 1 |   0   |  1
  1 | 0 |   0   |  1
  1 | 1 |   1   |  0
  ```
- **邏輯表達式**:
  - sum = a XOR b
  - carry = a AND b
- **實現方式**:
  - sum: 使用 Xor 閘
  - carry: 使用 And 閘
- **應用**: 最低有效位的加法運算

### FullAdder (全加器)
- **功能**: 計算三個位元的和與進位（兩個輸入位元 + 一個進位輸入）
- **輸入**: a, b, c (進位輸入)
- **輸出**: sum, carry
- **真值表**:
  ```
  a | b | c | carry | sum
  ---+---+---+-------+-----
  0 | 0 | 0 |   0   |  0
  0 | 0 | 1 |   0   |  1
  0 | 1 | 0 |   0   |  1
  0 | 1 | 1 |   1   |  0
  1 | 0 | 0 |   0   |  1
  1 | 0 | 1 |   1   |  0
  1 | 1 | 0 |   1   |  0
  1 | 1 | 1 |   1   |  1
  ```
- **邏輯表達式**:
  - sum = a XOR b XOR c
  - carry = (a AND b) OR (b AND c) OR (a AND c)
- **實現方式**:
  - 使用兩個 HalfAdder 和一個 Or 閘：
    1. 第一個 HalfAdder: 計算 a + b → sum1, carry1
    2. 第二個 HalfAdder: 計算 sum1 + c → sum, carry2
    3. 進位計算: carry = carry1 OR carry2
- **應用**: 多位元加法器的基本單元

## 多位元運算元件

### Add16 (16位元加法器)
- **功能**: 計算兩個16位元二進位數的和
- **輸入**: a[16], b[16]
- **輸出**: out[16]
- **操作**: out = a + b
- **實現方式**:
  ```
  1. 使用一個 HalfAdder 處理最低有效位 (LSB)
  2. 使用15個 FullAdder 串聯處理第1到15位
  3. 將前一個加法器的進位輸出連接到下一個加法器的進位輸入
  ```
- **結構示意**:
  ```
  a[0],b[0] → HalfAdder → out[0], carry0
  a[1],b[1],carry0 → FullAdder → out[1], carry1
  a[2],b[2],carry1 → FullAdder → out[2], carry2
  ...
  a[15],b[15],carry14 → FullAdder → out[15], carry15 (捨棄)
  ```
- **注意**: 進位輸出位元15被捨棄，可能導致溢位

### Inc16 (16位元增量器)
- **功能**: 將16位元輸入值加1
- **輸入**: in[16]
- **輸出**: out[16]
- **操作**: out = in + 1
- **實現方式**:
  - 方法1: 使用 Add16 將輸入與常數1相加
  - 方法2: 更有效率的方式：
    ```
    1. 使用一個 HalfAdder 處理最低有效位 (in[0] + 1)
    2. 使用15個 FullAdder 處理其他位元
    3. 每個 FullAdder 的輸入為 in[i] 和上一個加法器的進位
    ```
- **優化實現**:
  - 實際上可以簡化為：輸出 = 輸入 + 0000000000000001₂
  - 可透過專門的增量器邏輯減少延遲

## 算術邏輯單元 (ALU)

### ALU (16位元算術邏輯單元)
- **功能**: 執行多種算術和邏輯運算
- **輸入**:
  - x[16], y[16]: 兩個16位元運算元
  - zx: 將x輸入歸零
  - nx: 對x輸入取反
  - zy: 將y輸入歸零
  - ny: 對y輸入取反
  - f: 功能選擇 (0: AND, 1: ADD)
  - no: 對輸出取反
- **輸出**:
  - out[16]: 16位元運算結果
  - zr: 輸出是否為零 (1表示out=0)
  - ng: 輸出是否為負數 (1表示out<0)
- **運算流程**:
  1. **輸入處理階段**:
     - 如果 zx=1，則將 x 設為 0
     - 如果 nx=1，則將 x 取反
     - 如果 zy=1，則將 y 設為 0
     - 如果 ny=1，則將 y 取反
  2. **運算階段**:
     - 如果 f=0: 執行 x AND y
     - 如果 f=1: 執行 x + y (使用 Add16)
  3. **輸出處理階段**:
     - 如果 no=1: 將結果取反
     - 計算 zr 和 ng 標誌

- **控制位元組合與對應運算**:
  ```
  zx | nx | zy | ny |  f | no | 運算          | 說明
  ---+----+----+----+----+----+--------------+------------------
   1 | 0  | 1  | 0  | 1  | 0  | 0            | 常數0
   1 | 1  | 1  | 1  | 1  | 1  | 1            | 常數1
   1 | 1  | 1  | 0  | 1  | 0  | -1           | 常數-1
   0 | 0  | 1  | 1  | 0  | 0  | x            | 傳遞x
   1 | 1  | 0  | 0  | 0  | 0  | y            | 傳遞y
   0 | 0  | 1  | 1  | 0  | 1  | !x           | x的位元反相
   1 | 1  | 0  | 0  | 0  | 1  | !y           | y的位元反相
   0 | 0  | 1  | 1  | 1  | 1  | -x           | x的負數
   1 | 1  | 0  | 0  | 1  | 1  | -y           | y的負數
   0 | 1  | 1  | 1  | 1  | 1  | x+1          | x加1
   1 | 1  | 0  | 1  | 1  | 1  | y+1          | y加1
   0 | 0  | 1  | 1  | 1  | 0  | x-1          | x減1
   1 | 1  | 0  | 0  | 1  | 0  | y-1          | y減1
   0 | 0  | 0  | 0  | 1  | 0  | x+y          | 加法
   0 | 1  | 0  | 0  | 1  | 1  | x-y          | 減法(x-y)
   0 | 0  | 0  | 1  | 1  | 1  | y-x          | 減法(y-x)
   0 | 0  | 0  | 0  | 0  | 0  | x&y          | 位元AND
   0 | 1  | 0  | 1  | 0  | 1  | x|y          | 位元OR
  ```

- **狀態標誌計算**:
  - **zr (零標誌)**:
    - 方法1: 使用 Or8Way 檢查所有位元是否為0
    - 方法2: 使用多級 OR 閘樹檢查 out=0
  - **ng (負數標誌)**:
    - 直接取 out[15] (最高有效位，符號位)

- **內部結構**:
  1. 輸入處理模組: Mux 和 Not 閘組合
  2. 運算核心: And16 和 Add16
  3. 輸出處理: Mux 和 Not 閘
  4. 標誌產生: 比較器和位元檢查邏輯

## 設計架構與層級關係

```
基礎邏輯閘層:
  Nand → Not, And, Or, Xor → Mux, DMux

加法器層:
  HalfAdder (Xor + And)
    ↓
  FullAdder (2×HalfAdder + Or)
    ↓
  Add16 (HalfAdder + 15×FullAdder)
    ↓
  Inc16 (特殊化的Add16)

ALU元件層:
  ALU (整合):
    ├── 輸入處理: Mux16, Not16
    ├── 運算核心: And16, Add16
    ├── 輸出處理: Mux16, Not16
    └── 標誌產生: 比較邏輯電路
```

## 參考資源

*   [nand2tetris](https://drive.google.com/file/d/1CITliwTJzq19ibBF5EeuNBZ3MJ01dKoI/view)
*   [deepseek對話網址](https://chat.deepseek.com/share/m54iatez0yxczupw5q)